import Mathlib.Data.Real.Basic
import Mathlib.Tactic

theorem ist22_1_f_2 (x₁ x₂ : ℝ)
                    (h₁ : f₃ = (2.2-x₂)*(x₂-1.2))
                    (h₂ : f₄ = (x₁-2.2)*(5-x₁))
                    (h₃ : I =  (17*x₁)/2 - (151*x₂)/10 - (407*x₁^2*x₂^2)/10 - (13*x₁*x₂)/5
                    - (35*x₁*x₂^2)/2 + (123*x₁^2*x₂)/5 + (149*x₁*x₂^3)/5 + (103*x₁^3*x₂)/5
                    - (19*x₁^2)/5 - (131*x₁^3)/10 + (174*x₂^2)/5 - (9*x₁^4)/10 - (109*x₂^3)/5 - x₂^4 - 39/10) :
                    0 ≤ f₃ → 0 ≤ f₄ → 0 < I := by
  let p₀ : ℝ := (1541*x₁*x₂)/100 - (36537*x₂)/500 - (68979*x₁)/500 + (441*x₁^2)/25 + (5074*x₂^2)/375 + 2430719/10000
  let p₁ : ℝ := (398776422157*x₂)/1823039250 - (1788935208*x₁)/12153595
                + (2612131287*x₁*x₂)/121535950 + (220252913*x₁^2)/9722876 - (19310194433*x₂^2)/243071900
  let p₂ : ℝ := (546171581282563*x₁)/19938821107850 - (1124600732375597*x₁*x₂)/39877642215700
                - (16706993330407*x₁^2)/7975528443140 + (183257856425512*x₂^2)/9969410553925
  let p₃ : ℝ := (846983251090231*x₁^2)/923106897942360 - (407769926679074149*x₁*x₂)/81925737192384450
                + (4777601459342090201*x₂^2)/983108846308613400
  let p₄ : ℝ := (992058676878204052307*x₁*x₂)/2866560875605254120600 - (40324319344186540793*x₁^2)/191104058373683608040
  let p₅ : ℝ := (117101460341765231227*x₁^2)/9920586768782040523070

  let p₆ : ℝ := (173*x₂)/20 - (197*x₁)/10 + 124/5
  let p₇ : ℝ := (444247*x₂)/9920 - (192839*x₁)/4960
  let p₈ : ℝ := (1328561*x₁)/2221235

  let p₉ : ℝ := 33/2 - (21*x₂)/5 - (14*x₁)/5
  let q₀ : ℝ := (3226*x₂)/275 - (7329*x₁)/1100
  let q₁ : ℝ := (573451*x₁)/774240
  
  let σ₀ : ℝ := 10000/2430719*p₀^2 + 1823039250/398776422157*p₁^2 + 19938821107850/546171581282563*p₂^2
                + 983108846308613400/4777601459342090201*p₃^2 + 2866560875605254120600/992058676878204052307*p₄^2
                + 9920586768782040523070/117101460341765231227*p₅^2
  let σ₁ : ℝ := 5/124*p₆^2 + 9920/444247*p₇^2 + 2221235/1328561*p₈^2
  let σ₂ : ℝ := 2/33*p₉^2 + 275/3226*q₀^2 + 774240/573451*q₁^2
  let ε : ℝ := 1/10000
  have I₁ : I = σ₀ + σ₁*f₃ + σ₂*f₄ + ε := by
    simp [h₁, h₂, h₃]
    linear_combination
  intro f3 f4
  rw [I₁]
  have h1 : 0 ≤ σ₀ := by
    have : 0 ≤ (1541 * x₁ * x₂ / 100 - 36537 * x₂ / 500 - 68979 * x₁ / 500
              + 441 * x₁ ^ 2 / 25 + 5074 * x₂ ^ 2 / 375 + 2430719 / 10000) ^ 2 := by apply pow_two_nonneg
    have : 0 ≤ (398776422157 * x₂ / 1823039250 - 1788935208 * x₁ / 12153595
            + 2612131287 * x₁ * x₂ / 121535950 + 220252913 * x₁ ^ 2 / 9722876 - 19310194433 * x₂ ^ 2 / 243071900) ^ 2 := by apply pow_two_nonneg
    have : 0 ≤ (546171581282563 * x₁ / 19938821107850 - 1124600732375597 * x₁ * x₂ / 39877642215700 -
                  16706993330407 * x₁ ^ 2 / 7975528443140 + 183257856425512 * x₂ ^ 2 / 9969410553925) ^ 2 := by apply pow_two_nonneg
    have : 0 ≤ (846983251090231 * x₁ ^ 2 / 923106897942360
            - 407769926679074149 * x₁ * x₂ / 81925737192384450 + 4777601459342090201 * x₂ ^ 2 / 983108846308613400) ^ 2 := by apply pow_two_nonneg
    have : 0 ≤ (992058676878204052307 * x₁ * x₂ / 2866560875605254120600 -
            40324319344186540793 * x₁ ^ 2 / 191104058373683608040) ^ 2 := by apply pow_two_nonneg
    have : 0 ≤ 9920586768782040523070 / 117101460341765231227 * ((117101460341765231227 * x₁ ^ 2) ^ 2 / 9920586768782040523070 ^ 2) := by
      rw [←div_pow]
      have : 0 ≤ (117101460341765231227 * x₁ ^ 2 / 9920586768782040523070) ^ 2 := by apply pow_two_nonneg
      linarith
    simp
    linarith
  have h2 : 0 ≤ σ₁*f₃ := by
    have : 0 ≤ σ₁ := by
      have : 0 ≤ (173 * x₂ / 20 - 197 * x₁ / 10 + 124 / 5) ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ (444247 * x₂ / 9920 - 192839 * x₁ / 4960) ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ 2221235 / 1328561 * ((1328561 * x₁) ^ 2 / 2221235 ^ 2) := by
        rw [←div_pow]
        have : 0 ≤ (1328561 * x₁ / 2221235) ^ 2 := by apply pow_two_nonneg
        linarith
      simp
      linarith
    exact Right.mul_nonneg this f3
  have h3 : 0 ≤ σ₂*f₄ := by
    have : 0 ≤ σ₂ := by
      have : 0 ≤ (33 / 2 - 21 * x₂ / 5 - 14 * x₁ / 5) ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ (3226 * x₂ / 275 - 7329 * x₁ / 1100) ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ 774240 / 573451 * ((573451 * x₁) ^ 2 / 774240 ^ 2) := by
        rw [←div_pow]
        have : 0 ≤ (573451 * x₁ / 774240) ^ 2 := by apply pow_two_nonneg
        linarith
      simp
      linarith
    exact Right.mul_nonneg this f4
  have : 0 < ε := by norm_num
  linarith
